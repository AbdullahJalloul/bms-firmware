# Libre Solar BMS Firmware

![build badge](https://travis-ci.com/LibreSolar/bms-firmware.svg?branch=master)

This repository contains the firmware for the different Libre Solar Battery Management Systems. Originally, the firmware was based on [ARM Mbed OS](https://www.mbed.com). The current version also supports using [Zephyr RTOS](https://www.zephyrproject.org/) for some boards.

**Warning:** This firmware is under active development. Even though we try our best not to break any features that worked before, not every commit is fully tested on every board before including it to the master branch. As soon as the status of the firmware is considered stable enough, we will test the core features on all boards and generate a release.

## Supported devices

ARM Mbed OS:

- Libre Solar 3-5s (12V) BMS with TI bq76920: [BMS-5S50-SC](https://github.com/LibreSolar/bms-5s50-sc)
- Libre Solar 6-15s (24-48V) BMS with TI bq76930/40: [BMS-15S80-SC](https://github.com/LibreSolar/bms-15s80-sc)

Zephyr (preliminary):

- Libre Solar 3-8s (12V/24V) BMS with Intersil ISL94202: [BMS-8S50-IC](https://github.com/LibreSolar/bms-8s50-ic)

## Building and flashing the firmware

### ARM Mbed OS

It is suggested to use Visual Studio Code and PlatformIO for firmware development, as it simplifies compiling and uploading the code a lot:

1. Install Visual Studio Code and [PlatformIO](https://platformio.org/platformio-ide) to build the firmware.

2. Select the correct board in `platformio.ini` by removing the comment before the board name under `[platformio]`

3. Connect the board via a programmer. See the Libre Solar website for [further project-agnostic instructions](http://libre.solar/docs/flashing).

4. Press the upload button at the bottom left corner in VS Code.

### Zephyr

You can use Visual Studio Code as described above. However, Zephyr is [not yet](https://github.com/platformio/platformio-core/issues/1613) supported by PlatformIO, so you need to install and use the original Zephyr build system (called west) on the command-line.

1. Install Zephyr according to instructions on their website.

2. Setup environment variables:

    `source path/to/your/zeyphyr/installation/zephyr-env.sh`

2. Build the firmware by calling

    `west build`

4. Connect the board via a programmer.

5. Upload code to board with

    `west flash`

## API documentation

The documentation auto-generated by Doxygen can be found [here](https://libre.solar/bms-firmware/).
